# Решение домашнего задания к занятию «Микросервисы: принципы»
## Задача 1: API Gateway. Предложите решение для обеспечения реализации API Gateway. Составьте сравнительную таблицу возможностей различных программных решений. На основе таблицы сделайте выбор решения.

В мире есть множество API Gateway почти все они годятся для решения поставленной задачи.  
В таблице опишу те. с которыми сталкивался (Timeweb - не совсем то, но он разбавит в таблице знаки "+")  

|                | nginx | taefik | Yandex API Gateway | Балансировщик Timeweb |
|----------------|-------|--------|--------------------|-----------------------|
| маршрутизация  | +     | +      | +                  | -                     |
| аутентификация | +     | +      | +                  | -                     |
| HTTPS          | +     | +      | +                  | +                     |
| Облачный       | -     | -      | +                  | +                     |

Я бы остановил выбор на Nginx, поскольку работал с ним больше чем с другими

## Задача 2: Брокер сообщений. Составьте таблицу возможностей различных брокеров сообщений. На основе таблицы сделайте обоснованный выбор решения.

Опять. ограничусь теми решениями, с которыми имел дело

|                                                       | Kafka | RabbitMQ | ActiveMQ Artemis | OpenMQ |
|-------------------------------------------------------|-------|----------|------------------|--------|
| Поддержка кластеризации для обеспечения надежности    | +     | +        | +                | +      |
| Хранение сообщений на диске в процессе доставки       | +     | +        | +                | +      |
| Высокая скорость работы                               | +     | +        | +                | +/-    |
| Поддержка различных форматов сообщений                | +     | +        | +                | +      |
| Разделение прав доступа к различным потокам сообщений | +     | +        | +                | +      |
| Простота эксплуатации                                 | +/-   | +        | +                | -      |

Для проекта на spring я бы выбрал ActiveMQ.    
Для других технологий можно использовать RabbitMQ    

## Задача 3: API Gateway *
Что пришлось решить:  
1. Не стартовал сервиc security. Апнул зависисмости, выпилил экспортер метрик
2. Имя бакета переобозвал на images
3. Решил проблемы с доступом к бакету на скачивание
4. Ориентировался на цели из раздела "Ожидаемый результат"

Результат в папке app  https://github.com/pkostua/micros-2/tree/master/app  
nginx.conf  
```
worker_processes 1;
events { worker_connections 1024; }

http {
    server {
        listen 8080;
        server_name _;

        location /register {
            proxy_pass http://security:3000/v1/user;
        }

        location /token {
            proxy_pass http://security:3000/v1/token;
        }

        location /user {
            auth_request /auth;  # Проверка токена
            proxy_pass http://security:3000/v1/user;
        }

        location /upload {
            auth_request /auth;  # Проверка токена
            proxy_pass http://uploader:3000/v1/upload;
        }

        location /images/ {
            auth_request /auth;  # Проверка токена
            proxy_pass http://storage:9000/images/;
        }

        location = /auth {
            internal;
            proxy_pass http://security:3000/v1/token/validation;
        }
    }
}
```
